def modificacapo(selcapo)
	modcapo = Gtk::Window.new("Modifica movimento di ingresso")
	#modcapo.window_position=(Gtk::Window::POS_CENTER_ALWAYS)
	modcapo.set_default_size(800, 600)
	modcapo.maximize
	boxgen = Gtk::VBox.new(false, 0)
	boxgrande = Gtk::HBox.new(false, 0)
	boxmodcv1 = Gtk::HBox.new(false, 0)
	boxmodcv11 = Gtk::VBox.new(true, 0)
	boxmodcv12 = Gtk::VBox.new(true, 0)
	boxmodcv2 = Gtk::HBox.new(false, 0)
	boxmodcv21 = Gtk::VBox.new(true, 0)
	boxmodcv22 = Gtk::VBox.new(true, 0)
	boxmodc1 = Gtk::HBox.new(false, 0)
	boxmodc2 = Gtk::HBox.new(false, 0)
	boxmodc3 = Gtk::HBox.new(false, 0)
	boxmodc4 = Gtk::HBox.new(false, 0)
	boxmodc5 = Gtk::HBox.new(false, 0)
	boxmodc6 = Gtk::HBox.new(false, 0)
	boxmodc7 = Gtk::HBox.new(false, 0)
	boxmodc8 = Gtk::HBox.new(false, 0)
	boxmodc9 = Gtk::HBox.new(false, 0)
	boxmodc10 = Gtk::HBox.new(false, 0)
	boxmodc11 = Gtk::HBox.new(false, 0)
	boxmodc12 = Gtk::HBox.new(false, 0)
	boxmodc13 = Gtk::HBox.new(false, 0)
	boxmodc14 = Gtk::HBox.new(false, 0)
	boxmodc15 = Gtk::HBox.new(false, 0)
	boxmodc16 = Gtk::HBox.new(false, 0)
	boxmodc17 = Gtk::HBox.new(false, 0)
	boxmodc18 = Gtk::HBox.new(false, 0)
	boxmodc19 = Gtk::HBox.new(false, 0)
	boxmodc20 = Gtk::HBox.new(false, 0)
	boxmodc21 = Gtk::HBox.new(false, 0)
	boxmodc22 = Gtk::HBox.new(false, 0)
	boxmodc23 = Gtk::HBox.new(false, 0)
	boxmodc24 = Gtk::HBox.new(false, 0)
	boxmodc25 = Gtk::HBox.new(false, 0)
	boxmodc26 = Gtk::HBox.new(false, 0)
	boxmodc27 = Gtk::HBox.new(false, 0)
	boxmodc28 = Gtk::HBox.new(false, 0)
	boxmodc29 = Gtk::HBox.new(false, 0)
	boxmodc30 = Gtk::HBox.new(false, 0)
	boxmodc31 = Gtk::HBox.new(false, 0)
	boxmodc32 = Gtk::HBox.new(false, 0)
	boxmodc33 = Gtk::HBox.new(false, 0)
	boxmodc34 = Gtk::HBox.new(false, 0)
	boxmodc35 = Gtk::HBox.new(false, 0)
	boxmodc36 = Gtk::HBox.new(false, 0)
	boxmodc37 = Gtk::HBox.new(false, 0)
	boxmodc38 = Gtk::HBox.new(false, 0)
	boxmodc39 = Gtk::HBox.new(false, 0)
	boxmodc40 = Gtk::HBox.new(false, 0)
	boxmodc41 = Gtk::HBox.new(false, 0)
	boxmodc42 = Gtk::HBox.new(false, 0)
	boxmodc43 = Gtk::HBox.new(false, 0)
	boxmodc44 = Gtk::HBox.new(false, 0)
	boxmodc45 = Gtk::HBox.new(false, 0)
	boxmodc46 = Gtk::HBox.new(false, 0)
	boxmodc47 = Gtk::HBox.new(false, 0)
	boxmodc48 = Gtk::HBox.new(false, 0)
	boxmodc100 = Gtk::HBox.new(true, 0)
	boxmodcv11.pack_start(boxmodc1, false, false, 0)
	boxmodcv12.pack_start(boxmodc2, false, false, 0)
	boxmodcv11.pack_start(boxmodc3, false, false, 0)
	boxmodcv12.pack_start(boxmodc4, false, false, 0)
	boxmodcv11.pack_start(boxmodc5, false, false, 0)
	boxmodcv12.pack_start(boxmodc6, false, false, 0)
	boxmodcv11.pack_start(boxmodc7, false, false, 0)
	boxmodcv12.pack_start(boxmodc8, false, false, 0)
	boxmodcv11.pack_start(boxmodc9, false, false, 0)
	boxmodcv12.pack_start(boxmodc10, false, false, 0)
	boxmodcv11.pack_start(boxmodc11, false, false, 0)
	boxmodcv12.pack_start(boxmodc12, false, false, 0)
	boxmodcv11.pack_start(boxmodc13, false, false, 0)
	boxmodcv12.pack_start(boxmodc14, false, false, 0)
	boxmodcv11.pack_start(boxmodc15, false, false, 0)
	boxmodcv12.pack_start(boxmodc16, false, false, 0)
	boxmodcv11.pack_start(boxmodc17, false, false, 0)
	boxmodcv12.pack_start(boxmodc18, false, false, 0)
	boxmodcv11.pack_start(boxmodc19, false, false, 0)
	boxmodcv12.pack_start(boxmodc20, false, false, 0)
	boxmodcv11.pack_start(boxmodc21, false, false, 0)
	boxmodcv12.pack_start(boxmodc22, false, false, 0)
	boxmodcv11.pack_start(boxmodc23, false, false, 0)
	boxmodcv12.pack_start(boxmodc24, false, false, 0)
	boxmodcv21.pack_start(boxmodc25, false, false, 0)
	boxmodcv22.pack_start(boxmodc26, false, false, 0)
	boxmodcv21.pack_start(boxmodc27, false, false, 0)
	boxmodcv22.pack_start(boxmodc28, false, false, 0)
	boxmodcv21.pack_start(boxmodc29, false, false, 0)
	boxmodcv22.pack_start(boxmodc30, false, false, 0)
	boxmodcv21.pack_start(boxmodc31, false, false, 0)
	boxmodcv22.pack_start(boxmodc32, false, false, 0)
	boxmodcv21.pack_start(boxmodc33, false, false, 0)
	boxmodcv22.pack_start(boxmodc34, false, false, 0)
	boxmodcv21.pack_start(boxmodc35, false, false, 0)
	boxmodcv22.pack_start(boxmodc36, false, false, 0)
	boxmodcv21.pack_start(boxmodc37, false, false, 0)
	boxmodcv22.pack_start(boxmodc38, false, false, 0)
	boxmodcv21.pack_start(boxmodc39, false, false, 0)
	boxmodcv22.pack_start(boxmodc40, false, false, 0)
	boxmodcv21.pack_start(boxmodc41, false, false, 0)
	boxmodcv22.pack_start(boxmodc42, false, false, 0)
	boxmodcv21.pack_start(boxmodc43, false, false, 0)
	boxmodcv22.pack_start(boxmodc44, false, false, 0)
	boxmodcv21.pack_start(boxmodc45, false, false, 0)
	boxmodcv22.pack_start(boxmodc46, false, false, 0)
	boxmodcv21.pack_start(boxmodc47, false, false, 0)
	boxmodcv22.pack_start(boxmodc48, false, false, 0)
	boxmodcv1.pack_start(boxmodcv11, false, false, 0)
	boxmodcv1.pack_start(boxmodcv12, false, false, 0)
	boxmodcv2.pack_start(boxmodcv21, false, false, 0)
	boxmodcv2.pack_start(boxmodcv22, false, false, 0)
	boxgrande.pack_start(boxmodcv1, true, true)
	boxgrande.pack_start(boxmodcv2, true, true)
	boxgen.pack_start(boxgrande, true, true)
	boxgen.pack_start(boxmodc100, false, false)
	modcapo.add(boxgen)
	#Modifica marca

	capomod = selcapo.selected
	#puts capomod[46]
#	puts "#{capomod[18][6,4]}-#{capomod[18][3,2]}-#{capomod[18][0,2]}"
	#puts @selcapo[18]
	#capomodreg = Registros.find(:first, :conditions => "relaz_id='#{@stallaoper}' and marca='#{capomod[3]}' and dataingresso='#{capomod[18][6,4]}-#{capomod[18][3,2]}-#{capomod[18][0,2]}'")
#	puts capomodreg.relaz_id
#	puts capomodreg.marca
#	puts capomodreg.dataingresso
	labelmarca = Gtk::Label.new("Marca:")
	boxmodc1.pack_end(labelmarca, false, false, 5)
	marca = Gtk::Entry.new()
	marca.max_length=(14)
	marca.text = ("#{capomod[3]}")
	boxmodc2.pack_start(marca, false, false, 5)

	#Specie

	labelspecie = Gtk::Label.new("Specie:")
	boxmodc3.pack_end(labelspecie, false, false, 5)
	specie1 = Gtk::RadioButton.new("Bovini")
	boxmodc4.pack_start(specie1, false, false, 5)
	specie2 = Gtk::RadioButton.new(specie1, "Bufalini")
	boxmodc4.pack_start(specie2, false, false, 5)
	valspecie = capomod[4]
	if capomod[4] == "BOV"
		specie1.active=(true)
	else
		specie2.active=(true)
	end

	specie1.signal_connect("toggled") {
		if specie1.active?
			valspecie = "BOV" 
		end
	}
	specie2.signal_connect("toggled") {
		if specie2.active?
			valspecie = "BUF"
		end
	}

	#Modifica razza

	labelrazza = Gtk::Label.new("Razza:")
	listarazze = Gtk::ListStore.new(Integer, String, String)
	selrazze = Razzas.find(:all, :order =>"razza")
	selrazze.each do |r|
		iter1 = listarazze.append
		iter1[0] = r.id.to_i
		iter1[1] = r.razza
		iter1[2] = r.cod_razza
	end
	comborazze = Gtk::ComboBox.new(listarazze)
	renderer1 = Gtk::CellRendererText.new
	comborazze.pack_start(renderer1,false)
	comborazze.set_attributes(renderer1, :text => 1)
	renderer1 = Gtk::CellRendererText.new
	renderer1.visible=(false)
	comborazze.pack_end(renderer1,false)
	comborazze.set_attributes(renderer1, :text => 2)
	boxmodc5.pack_end(labelrazza, false, false, 5)
	boxmodc6.pack_start(comborazze.popdown, false, false, 0)

	comborazze.set_active(0)
	contarazze = -1
	while comborazze.active_iter[1] != capomod[5]
		contarazze+=1
		comborazze.set_active(contarazze)
	end

	#Modifica data di nascita

	labelnascita = Gtk::Label.new("Data di nascita (GGMMAA):")
	boxmodc7.pack_end(labelnascita, false, false, 5)
	nascita = Gtk::Entry.new()
	nascita.max_length=(6)
	nascita.text = ("#{capomod[6][0,2]}#{capomod[6][3,2]}#{capomod[6][8,2]}")
	boxmodc8.pack_start(nascita, false , false, 0)

	#Modifica sesso

	labelsesso = Gtk::Label.new("Sesso:")
	boxmodc9.pack_end(labelsesso, false, false, 5)
	sesso1 = Gtk::RadioButton.new("M")
	boxmodc10.pack_start(sesso1, false, false, 5)
	sesso2 = Gtk::RadioButton.new(sesso1, "F")
	boxmodc10.pack_start(sesso2, false, false, 5)
	valsesso = capomod[8]
	if capomod[8] == "M"
		sesso1.active=(true)
	else
		sesso2.active=(true)
	end

	sesso1.signal_connect("toggled") {
		if sesso1.active?
			valsesso="M"
		end
	}
	sesso2.signal_connect("toggled") {
		if sesso2.active?
			valsesso="F"
		end
	}

	#Modifica stalla di nascita / prima importazione

	labelstallanas = Gtk::Label.new("Stalla nascita / prima importazione:")
	stallanas = Gtk::Entry.new()
	stallanas.max_length=(8)
	stallanas.text = ("#{capomod[7]}")
	boxmodc11.pack_end(labelstallanas, false, false, 5)
	boxmodc12.pack_start(stallanas, false, false, 5)

	#Nazione origine

	labelnazorig = Gtk::Label.new("Nazione di origine:")
	boxmodc13.pack_end(labelnazorig, false, false, 5)
	listanazorig = Gtk::ListStore.new(Integer, String, String, Integer)
	listanazorig.clear
	selnazorig = Nations.find(:all, :order => "nome")
	selnazorig.each do |no|
		iter1 = listanazorig.append
		iter1[0] = no.id
		iter1[1] = no.nome
		iter1[2] = no.codice
		iter1[3] = no.tipo
	end
	combonazorig = Gtk::ComboBox.new(listanazorig)
	renderer1 = Gtk::CellRendererText.new
	renderer1.visible=(false)
	combonazorig.pack_start(renderer1,false)
	combonazorig.set_attributes(renderer1, :text => 0)
	renderer1 = Gtk::CellRendererText.new
	combonazorig.pack_start(renderer1,false)
	combonazorig.set_attributes(renderer1, :text => 1)
	renderer1 = Gtk::CellRendererText.new
	renderer1.visible=(false)
	combonazorig.pack_start(renderer1,false)
	combonazorig.set_attributes(renderer1, :text => 2)
	renderer1 = Gtk::CellRendererText.new
	renderer1.visible=(false)
	combonazorig.pack_start(renderer1,false)
	combonazorig.set_attributes(renderer1, :text => 3)
	boxmodc14.pack_start(combonazorig.popdown, false, false, 0)

	combonazorig.set_active(0)
	contanazorig = -1
	while combonazorig.active_iter[2] != capomod[9]
		contanazorig+=1
		combonazorig.set_active(contanazorig)
	end

	#Nazione nascita / prima importazione

	labelnaznas = Gtk::Label.new("Nazione nascita / prima importazione:")
	boxmodc15.pack_end(labelnaznas, false, false, 5)
	listanaznas = Gtk::ListStore.new(Integer, String, String)
	listanaznas.clear
	selnaznas = Nations.find(:all, :order => "nome")
	selnaznas.each do |n|
		iter1 = listanaznas.append
		iter1[0] = n.id
		iter1[1] = n.nome
		iter1[2] = n.codice
	end
	combonaznas = Gtk::ComboBox.new(listanaznas)
	renderer1 = Gtk::CellRendererText.new
	renderer1.visible=(false)
	combonaznas.pack_start(renderer1,false)
	combonaznas.set_attributes(renderer1, :text => 0)
	renderer1 = Gtk::CellRendererText.new
	combonaznas.pack_start(renderer1,false)
	combonaznas.set_attributes(renderer1, :text => 1)
	renderer1 = Gtk::CellRendererText.new
	renderer1.visible=(false)
	combonaznas.pack_start(renderer1,false)
	combonaznas.set_attributes(renderer1, :text => 2)
	boxmodc16.pack_start(combonaznas.popdown, false, false, 0)

	combonaznas.set_active(0)
	contanaznas = -1
	while combonaznas.active_iter[2] != capomod[10]
		contanaznas+=1
		combonaznas.set_active(contanaznas)
	end

	#Data applicazione marca

	labelmarcatura = Gtk::Label.new("Data applicazione marca (GGMMAA):")
	boxmodc17.pack_end(labelmarcatura, false, false, 5)
	marcatura = Gtk::Entry.new()
	marcatura.max_length=(6)
	if capomod[11] != nil
		marcatura.text = ("#{capomod[11][0,2]}#{capomod[11][3,2]}#{capomod[11][8,2]}")
	end
	boxmodc18.pack_start(marcatura, false, false, 0)

	#Iscrizione libro genealogico

	labelgen = Gtk::Label.new("Iscrizione libro genealogico:")
	boxmodc19.pack_end(labelgen, false, false, 5)
	gen1 = Gtk::RadioButton.new("S")
	boxmodc20.pack_start(gen1, false, false, 5)
	gen2 = Gtk::RadioButton.new(gen1, "N")
	boxmodc20.pack_start(gen2, false, false, 5)
	gen3 = Gtk::RadioButton.new(gen1, "NULLO")
	boxmodc20.pack_start(gen3, false, false, 5)
	valgen = capomod[12]
	if capomod[12] == "S"
		gen1.active=(true)
	elsif capomod[12] == "N"
		gen2.active=(true)
	else
		gen3.active=(true)
	end

	gen1.signal_connect("toggled") {
		if gen1.active?
			valgen="S"
		end
	}
	gen2.active=(true)
	gen2.signal_connect("toggled") {
		if gen2.active?
			valgen="N"
		end
	}
	gen3.signal_connect("toggled") {
		if gen3.active?
			valgen="NULLO"
		end
	}

	#Embryo transer

	labelembryo = Gtk::Label.new("Embryo transfer:")
	boxmodc21.pack_end(labelembryo, false, false, 5)
	embryo1 = Gtk::RadioButton.new("S")
	boxmodc22.pack_start(embryo1, false, false, 5)
	embryo2 = Gtk::RadioButton.new(embryo1, "N")
	boxmodc22.pack_start(embryo2, false, false, 5)
	valembryo = capomod[12]
	if capomod[12] == "S"
		embryo1.active=(true)
	else
		embryo2.active=(true)
	end

	embryo1.signal_connect("toggled") {
		if embryo1.active?
			valembryo="S"
		end
	}
	embryo2.signal_connect("toggled") {
		if embryo2.active?
			valembryo="N"
		end
	}

	#Marca precedente

	labelprec = Gtk::Label.new("Marca precedente:")
	boxmodc23.pack_end(labelprec, false, false, 5)
	prec = Gtk::Entry.new()
	prec.max_length=(14)
	prec.text = ("#{capomod[13]}")
	boxmodc24.pack_start(prec, false, false, 5)

	#Marca madre

	labelmadre = Gtk::Label.new("Marca madre:")
	boxmodc25.pack_end(labelmadre, false, false, 5)
	madre = Gtk::Entry.new()
	madre.max_length=(14)
	madre.text = ("#{capomod[14]}")
	boxmodc26.pack_start(madre, false, false, 5)

	#Marca padre

	labelpadre = Gtk::Label.new("Marca padre:")
	boxmodc27.pack_end(labelpadre, false, false, 5)
	padre = Gtk::Entry.new()
	padre.max_length=(14)
	padre.text = ("#{capomod[15]}")
	boxmodc28.pack_start(padre, false, false, 5)

	#Marca donatrice

	labeldon = Gtk::Label.new("Marca donatrice:")
	boxmodc29.pack_end(labeldon, false, false, 5)
	don = Gtk::Entry.new()
	don.max_length=(14)
	don.text = ("#{capomod[16]}")
	boxmodc30.pack_start(don, false, false, 5)

	#Codice libro genealogico

	labellibgen = Gtk::Label.new("Codice libro genealogico:")
	boxmodc31.pack_end(labellibgen, false, false, 5)
	libgen = Gtk::Entry.new()
	libgen.max_length=(50)
	libgen.text = ("#{capomod[43]}")
	boxmodc32.pack_start(libgen, false, false, 5)

	#Modifica motivo ingresso

	labelmovingr = Gtk::Label.new("Motivo ingresso:")
	listamovingr = Gtk::ListStore.new(Integer, String)
	selmovingr = Ingressos.find(:all)
	selmovingr.each do |i|
		iter1 = listamovingr.append
		iter1[0] = i.codice.to_i
		iter1[1] = i.descr
	end
	combomovingr = Gtk::ComboBox.new(listamovingr)
	renderer1 = Gtk::CellRendererText.new
	renderer1.visible=(false)
	combomovingr.pack_start(renderer1,false)
	combomovingr.set_attributes(renderer1, :text => 0)
	renderer1 = Gtk::CellRendererText.new
	combomovingr.pack_start(renderer1,false)
	combomovingr.set_attributes(renderer1, :text => 1)
	boxmodc33.pack_end(labelmovingr, false, false, 5)
	boxmodc34.pack_start(combomovingr.popdown, false, false, 0)
	combomovingr.set_active(0)
	contamovingr = -1
	while combomovingr.active_iter[0].to_i != capomod[17].to_i
		contamovingr+=1
		combomovingr.set_active(contamovingr)
	end

	#Modifica data ingresso

	labeldataingr = Gtk::Label.new("Data di ingresso (GGMMAA):")
	boxmodc35.pack_end(labeldataingr, false, false, 5)
	dataingr = Gtk::Entry.new()
	dataingr.max_length=(6)
	dataingr.text = ("#{capomod[18][0,2]}#{capomod[18][3,2]}#{capomod[18][8,2]}")
	boxmodc36.pack_start(dataingr, false , false, 0)

	#Nazione di provenienza

	labelnazprov = Gtk::Label.new("Nazione di provenienza:")
	boxmodc37.pack_end(labelnazprov, false, false, 5)
	listanazprov = Gtk::ListStore.new(Integer, String, String)
	listanazprov.clear
	selnazprov = Nations.find(:all, :order => "nome")
	selnazprov.each do |n|
		iter1 = listanazprov.append
		iter1[0] = n.id
		iter1[1] = n.nome
		iter1[2] = n.codice
	end
	combonazprov = Gtk::ComboBox.new(listanazprov)
	renderer1 = Gtk::CellRendererText.new
	renderer1.visible=(false)
	combonazprov.pack_start(renderer1,false)
	combonazprov.set_attributes(renderer1, :text => 0)
	renderer1 = Gtk::CellRendererText.new
	combonazprov.pack_start(renderer1,false)
	combonazprov.set_attributes(renderer1, :text => 1)
	renderer1 = Gtk::CellRendererText.new
	renderer1.visible=(false)
	combonazprov.pack_start(renderer1,false)
	combonazprov.set_attributes(renderer1, :text => 2)
	boxmodc38.pack_start(combonazprov.popdown, false, false, 0)
	combonazprov.set_active(0)
	contanazprov = -1
	while combonazprov.active_iter[2] != capomod[22]
		contanazprov+=1
		combonazprov.set_active(contanazprov)
	end

	#Certificato sanitario

	labelcertsan = Gtk::Label.new("Certificato sanitario:")
	boxmodc39.pack_end(labelcertsan, false, false, 5)
	certsan = Gtk::Entry.new()
	certsan.max_length=(21)
	certsan.width_chars=(21)
	certsan.text = ("#{capomod[23]}")
	boxmodc40.pack_start(certsan, false, false, 5)

	#Riferimento locale

	labelrifloc = Gtk::Label.new("Riferimento locale:")
	boxmodc41.pack_end(labelrifloc, false, false, 5)
	rifloc = Gtk::Entry.new()
	rifloc.max_length=(21)
	rifloc.width_chars=(21)
	rifloc.text = ("#{capomod[24]}")
	boxmodc42.pack_start(rifloc, false, false, 5)

	#Allevamento provenienza
	labelallprov = Gtk::Label.new("Allevamento di provenienza:")
	boxmodc43.pack_end(labelallprov, false, false, 5)
	listaallprov = Gtk::ListStore.new(Integer, String, String, String)
	listaallprov.clear
	selallprov = Allevamentis.find(:all, :order => "ragsoc")
	selallprov.each do |a|
		iter1 = listaallprov.append
		iter1[0] = a.id
		iter1[1] = a.ragsoc
		iter1[2] = a.idfisc
		iter1[3] = a.cod317
	end
	comboallprov = Gtk::ComboBox.new(listaallprov)
	renderer1 = Gtk::CellRendererText.new
	renderer1.visible=(false)
	comboallprov.pack_start(renderer1,false)
	comboallprov.set_attributes(renderer1, :text => 0)
	renderer1 = Gtk::CellRendererText.new
	comboallprov.pack_start(renderer1,false)
	comboallprov.set_attributes(renderer1, :text => 1)
	renderer1 = Gtk::CellRendererText.new
	renderer1.visible=(false)
	comboallprov.pack_start(renderer1,false)
	comboallprov.set_attributes(renderer1, :text => 2)
	renderer1 = Gtk::CellRendererText.new
	renderer1.visible=(false)
	comboallprov.pack_start(renderer1,false)
	comboallprov.set_attributes(renderer1, :text => 3)
	boxmodc44.pack_start(comboallprov.popdown, false, false, 5)
	if capomod[19] != ""
#	if capomod[46] != ""
		comboallprov.set_active(0)
#		puts comboallprov.active_iter[0]
		contaallprov = -1
#		while comboallprov.active_iter[3] != capomod[19]
		while comboallprov.active_iter[0] != capomod[46].to_i
			contaallprov+=1
			comboallprov.set_active(contaallprov)
		end
		else
		comboallprov.set_active(-1)
	end

	#Modello 4

	labelmod4 = Gtk::Label.new("Modello 4:")
	boxmodc45.pack_end(labelmod4, false, false, 5)
	mod4 = Gtk::Entry.new()
	mod4.text = ("#{capomod[26]}")
	boxmodc46.pack_start(mod4, false, false, 5)

	#Data modello 4

	labeldatamod4 = Gtk::Label.new("Data modello 4 (GGMMAA):")
	boxmodc47.pack_end(labeldatamod4, false, false, 5)
	datamod4 = Gtk::Entry.new()
	datamod4.max_length=(6)
	#dataingr.text = ("#{capomod[18]}")
	if capomod[27] != nil
		datamod4.text = ("#{capomod[27][0,2]}#{capomod[27][3,2]}#{capomod[27][8,2]}")
	end
	boxmodc48.pack_start(datamod4, false , false, 0)

	#Bottone di inserimento

	bottmodcapo = Gtk::Button.new( "Modifica capo" )
	bottmodcapo.signal_connect("clicked") {
		errore = nil
		begin
			datanasingl = nascita.text[4,2] + nascita.text[2,2] + nascita.text[0,2]
			datanasingl = Time.parse("#{datanasingl}").strftime("%Y")[0,2] + datanasingl
			Time.parse("#{datanasingl}")
			if marca.text == "" or comborazze.active == -1 or nascita.text == "" or combonazorig.active == -1 or combonaznas.active == -1 or combomovingr.active == -1
				Errore.avviso(modcapo, "Mancano dei dati obbligatori.")
				errore = 1
			elsif marca.text[0,2].upcase == "IT" and marca.text.length < 14
				Errore.avviso(modcapo, "Marca corta.")
				errore = 1
			elsif nascita.text.to_i == 0
				Errore.avviso(modcapo, "Data di nascita errata.")
				errore = 1
			elsif dataingr.text.to_i == 0
				Errore.avviso(modcapo, "Data di ingresso errata.")
				errore = 1
			elsif marcatura.text != "" and marcatura.text.to_i == 0
				Errore.avviso(modcapo, "lettere.")
				errore = 1
			elsif marcatura.text == "" #or @marcatura.text == 0 	#	elsif @datamod4.text != "" and @datamod4.text.to_i != 0
				datamarcingl = ""
			end
			if Time.parse("#{datanasingl}") > @giorno
					Errore.avviso(modcapo, "La data di nascita non può essere successiva al giorno odierno.")
					errore = 1
			end
		rescue Exception => errore
			Errore.avviso(modcapo, "Errore generico")
			errore = 1
		end

		if errore == nil
			dataingingl = dataingr.text[4,2] + dataingr.text[2,2] + dataingr.text[0,2]
			dataingingl = Time.parse("#{dataingingl}").strftime("%Y")[0,2] + dataingingl
			if marcatura.text != ""
				datamarcingl = marcatura.text[4,2] + marcatura.text[2,2] + marcatura.text[0,2]
				datamarcingl = Time.parse("#{datamarcingl}").strftime("%Y")[0,2] + datamarcingl
			else
				datamarcingl = ""
			end
			if datamod4.text != ""
				datamod4ingl = datamod4.text[4,2] + datamod4.text[2,2] + datamod4.text[0,2]
				datamod4ingl = Time.parse("#{datamod4ingl}").strftime("%Y")[0,2] + datamod4ingl
			else
				datamod4ingl = nil
			end

			if comboallprov.active == -1
				allprov = ""
			else
				allprov = comboallprov.active_iter[0]
			end
			Animals.update(capomod[0], {:marca => "#{marca.text.upcase}", :specie => "#{valspecie}", :razza_id => "#{comborazze.active_iter[0]}", :data_nas => "#{datanasingl.to_i}", :sesso => "#{valsesso}", :stalla_nas => "#{stallanas.text.upcase}", :naz_orig => "#{combonazorig.active_iter[2]}", :naz_nasprimimp => "#{combonaznas.active_iter[2]}", :data_applm => "#{datamarcingl}", :ilg => "#{valgen}", :embryo => "#{valembryo}", :marca_prec => "#{prec.text.upcase}", :marca_madre => "#{madre.text.upcase}", :marca_padre => "#{padre.text.upcase}", :donatrice => "#{don.text.upcase}", :clg => "#{libgen.text.upcase}", :cm_ing => "#{combomovingr.active_iter[0]}", :data_ingr => "#{dataingingl.to_i}", :naz_prov => "#{combonazprov.active_iter[2]}", :certsan => "#{certsan.text.upcase}", :rifloc => "#{rifloc.text.upcase}", :allevamenti_id => "#{allprov}", :mod4 => "#{mod4.text}", :data_mod4 => "#{datamod4ingl.to_i}"})
			if capomod[45] == "SI"
				#puts "vero"
				if combomovingr.active_iter[0] == 1
					regingr = "N"
				elsif combomovingr.active_iter[0] == 19
					regingr = "C"
				else
					regingr = "A"
				end
				if combomovingr.active_iter[0] == 2 or combomovingr.active_iter[0] == 1 or combomovingr.active_iter[0] == 19 or combomovingr.active_iter[0] == 24 or combomovingr.active_iter[0] == 25 or combomovingr.active_iter[0] == 26
					regprov = comboallprov.active_iter[3]
				elsif combomovingr.active_iter[0] == 13 or combomovingr.active_iter[0] == 23 or combomovingr.active_iter[0] == 32
					if certsan.text != "" #or iter.certsan != nil
						regprov = certsan.text.upcase
					else
						regprov = rifloc.text.upcase
					end
				end
				#capomodreg = Registros.find(:first, :conditions => "relaz_id='#{@stallaoper.id}' and marca LIKE '#{capomod[3]}' and dataingresso='#{capomod[18][6,4]}-#{capomod[18][3,2]}-#{capomod[18][0,2]}'")
				capomodreg = Registros.find(:first, :conditions => ["relaz_id= ? and marca = ? and dataingresso= ?", "#{@stallaoper.id}", "#{capomod[3]}", "#{capomod[18][6,4]}-#{capomod[18][3,2]}-#{capomod[18][0,2]}"])
				#puts capomodreg.id
				#puts capomodreg.marca
				Registros.update(capomodreg.id, {:marca => "#{marca.text.upcase}", :razza => "#{comborazze.active_iter[2]}", :sesso => "#{valsesso}", :madre => "#{madre.text.upcase}", :tipoingresso => "#{regingr}", :datanascita => "#{datanasingl.to_i}", :dataingresso => "#{dataingingl.to_i}", :provenienza => "#{regprov}", :mod4ingr => "#{mod4.text.upcase}", :certsaningr => "#{certsan.text.upcase}", :marcaprec => "#{prec.text.upcase}"})
			end
			Conferma.conferma(modcapo, "Movimento modificato.")
			modcapo.destroy
		else
			#puts "Errore"
			#Errore.avviso(modcapo, "C'è un errore.")
		end
	}
	boxmodc100.pack_start(bottmodcapo, false, false, 5)

# Bottone di eliminazione del movimento

	bottelimina = Gtk::Button.new( "Elimina capo" )
	bottelimina.signal_connect("clicked") {
		if capomod[44].to_i == 1
			Errore.avviso(modcapo, "Prima di poter eliminare il movimento di ingresso bisogna eliminare l'uscita.")
		else
			avviso = Gtk::MessageDialog.new(modcapo, Gtk::Dialog::DESTROY_WITH_PARENT, Gtk::MessageDialog::QUESTION, Gtk::MessageDialog::BUTTONS_YES_NO, "Elimino il movimento di ingresso del capo #{capomod[3]} ?")
			risposta = avviso.run
			avviso.destroy
			if risposta == Gtk::Dialog::RESPONSE_YES
				Animals.delete(capomod[0])
				Conferma.conferma(modcapo, "Movimento eliminato.")
				modcapo.destroy
			else
				Conferma.conferma(modcapo, "Movimento non eliminato.")
			end
		end
	}
	boxmodc100.pack_start(bottelimina, false, false, 5)

# Bottone di chiusura finestra

	bottchiudi = Gtk::Button.new( "Chiudi" )
	bottchiudi.signal_connect("clicked") {
		modcapo.destroy
	}
	boxmodc100.pack_start(bottchiudi, false, false, 5)
	modcapo.show_all
end
